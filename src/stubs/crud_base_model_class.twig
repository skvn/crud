<?php namespace {{ model.namespace }}\Crud;

use Skvn\Crud\Models\CrudModel;
{%  if model.attaches %}use Skvn\Crud\Traits\AttachmentTrait;
use Skvn\Crud\Models\CrudFile;
{% endif %}
{% if model.inline_img %}use Skvn\Crud\Traits\InlineImgTrait;{% endif %}

class {{ model.name }}Base extends CrudModel{

{% if model.traits %}
    use  {{ model.traits|join(', ') }} {
        {%  if model.attaches %}AttachmentTrait::boot as attachBoot;{% endif %}
        {% if model.inline_img %}InlineImgTrait::boot as inlineImgBoot;{% endif %}
    }
{% endif %}


	protected $table = '{{ model.table }}';
	{%  if not  model.timestamps  %}
	public $timestamps = false;
	{% endif %}

	public function __construct(array $attributes = array())
	{
	    {% for a in model.attaches %}
        $this->setAttach('{{ a.column }}',['multi'=>{{ a.multi }}]);
        {% endfor %}
        {% if model.inline_img %}
        $this->setInlineImgCols({{ model.inline_img|json_encode|raw }});
        {% endif %}
        parent::__construct($attributes);
    }//


    public static function boot()
    {
        {%  if model.attaches %}self::attachBoot();
        {% endif %}
        {% if model.inline_img %}self::inlineImgBoot();
        {% endif %}
        parent::boot();
    }

    {% for a in model.attaches %}
    {% if a.multi == '1' %}
    public function {{ a.column }}()
    {
         return $this->belongsToMany('\Skvn\Crud\Models\CrudFile', '{{ a.pivot_table }}');
    }
    {% endif %}
    {% endfor %}


}
